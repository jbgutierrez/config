# show elapsed time if command took more than X seconds
REPORTTIME=10
# ask to complete if top of list would scroll off screen
LISTMAX=0

# command history configuration
HISTFILE=$HOME/.zsh_history
HISTSIZE=10000
SAVEHIST=10000

# make CTRL-W delete after other chars, not just spaces
WORDCHARS=${WORDCHARS//[&=\/;\!#%\{]}

# make with the pretty colors
autoload -U colors; colors

for COLOR in RED GREEN YELLOW MAGENTA; do
  eval PR_$COLOR='%{$fg[${(L)COLOR}]%}'
  eval PR_BRIGHT_$COLOR='%{$fg_bold[${(L)COLOR}]%}'
done
PR_RESET="%{${reset_color}%}";

PROMPT='${PR_MAGENTA}$(date +%H:%M) %~ $(git_info)${PR_RESET}
â†’ '
RPROMPT='%U${PR_WHITE}$(git_log)%u${PR_RESET}'

# turn on command substitution in the prompt
setopt prompt_subst

refresh_git_status() {
  unstaged=false staged=false stashed=false
  if [[ $(git diff --ignore-submodules=dirty --cached --name-status 2>/dev/null ) != "" ]]; then
    staged=true
  fi
  if [[ $(git diff --ignore-submodules=dirty --name-status 2>/dev/null ) != "" ]]; then
    unstaged=true
  fi
  if [[ $(git stash list) != "" ]]; then
    stashed=true
  fi
}

git_info() {
  branch_name=`git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1/'`
  if [[ ${branch_name} != "" ]]; then
    refresh_git_status
    status_color=${PR_GREEN}
    if ${staged}; then
      status_color=${PR_YELLOW}
      if ${unstaged}; then
        branch_name+=${PR_RED}' + unstaged data'
      fi
    elif ${unstaged}; then
      status_color=${PR_RED}
    fi
    if ${stashed}; then
      branch_name+=${PR_RED}' + stashed commit'
    fi
    echo "${status_color}[${branch_name}${status_color}] "
  fi
}

git_log() {
  git log --pretty=format:"%h - %ar : %s" -n 1 2> /dev/null
}

# show a message with the exit code when a command returns with a non-zero exit code
setopt print_exit_value

# don't want to be corrected
unsetopt correct
unsetopt correctall

setopt                                       \
  append_history                             \
  extended_history                           \
  hist_expire_dups_first                     \
  hist_ignore_dups                           \
  hist_ignore_space                          \
  hist_verify                                \
  inc_append_history                         \
  share_history

# globbing on steroids
setopt extended_glob

# other tabbing options
# setopt no_auto_menu
# setopt bash_auto_list

# quote pasted URLs
autoload url-quote-magic
zle -N self-insert url-quote-magic

# load completions for Ruby, Git, etc.
autoload compinit; compinit

# multiple move
autoload zmv

# completion for kill-like commands
zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#) ([0-9a-z-]#)*=01;34=0=01'
zstyle ':completion:*:*:*:*:processes' command "ps -u `whoami` -o pid,user,comm -w -w"
zstyle ':completion:*:ssh:*' tag-order hosts users
zstyle ':completion:*:ssh:*' group-order hosts-domain hosts-host users hosts-ipaddr

bindkey -e

# ruby version manager
if which rbenv > /dev/null; then eval "$(rbenv init -)"; fi
